# Recipe Generation System - Architecture Diagrams

## 1. High-Level Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     USER INTERACTION                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  1. Start Conversation                                           â”‚
â”‚     â†“                                                            â”‚
â”‚  2. Chat with ElevenLabs AI Agent (voice)                      â”‚
â”‚     â†“                                                            â”‚
â”‚  3. Stop Conversation                                           â”‚
â”‚     â†“                                                            â”‚
â”‚  4. Click "Generate Recipe" Button (Orange)                    â”‚
â”‚     â†“                                                            â”‚
â”‚  5. Wait for LLM to process...                                 â”‚
â”‚     â†“                                                            â”‚
â”‚  6. See success message with recipe link                       â”‚
â”‚     â†“                                                            â”‚
â”‚  7. Click link (or auto-opens) in new tab                     â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Component Communication

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLIENT SIDE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         Conversation Component (React)                    â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â€¢ ElevenLabs Voice Integration                         â”‚  â”‚
â”‚  â”‚  â€¢ Message Display                                      â”‚  â”‚
â”‚  â”‚  â€¢ Control Buttons:                                     â”‚  â”‚
â”‚  â”‚    - Start Conversation                                â”‚  â”‚
â”‚  â”‚    - Stop Conversation                                 â”‚  â”‚
â”‚  â”‚    - Save Conversation                                 â”‚  â”‚
â”‚  â”‚    - â­ Generate Recipe â† NEW BUTTON                    â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â€¢ conversationHistory State                            â”‚  â”‚
â”‚  â”‚  â€¢ isSaving State                                       â”‚  â”‚
â”‚  â”‚  â€¢ â­ isGeneratingRecipe State (NEW)                    â”‚  â”‚
â”‚  â”‚  â€¢ â­ generatedRecipeId State (NEW)                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â”‚ POST /api/recipes/generate                            â”‚
â”‚         â”‚ { messages[], conversationTitle }                     â”‚
â”‚         â†“                                                        â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â”‚ (HTTP Request)
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SERVER SIDE                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    /api/recipes/generate/route.ts (POST)                â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  1. Authenticate with Clerk                             â”‚  â”‚
â”‚  â”‚  2. Validate request body                               â”‚  â”‚
â”‚  â”‚  3. Format conversation for LLM                         â”‚  â”‚
â”‚  â”‚  4. Call OpenAI API                                     â”‚  â”‚
â”‚  â”‚     â””â”€â†’ gpt-4o-mini                                     â”‚  â”‚
â”‚  â”‚  5. Parse JSON response                                 â”‚  â”‚
â”‚  â”‚  6. Validate recipe structure                           â”‚  â”‚
â”‚  â”‚  7. Call db.saveRecipe()                                â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        /lib/db.ts - saveRecipe()                         â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  â€¢ Prisma ORM                                            â”‚  â”‚
â”‚  â”‚  â€¢ Create Recipe document                               â”‚  â”‚
â”‚  â”‚  â€¢ Associate with userId                                â”‚  â”‚
â”‚  â”‚  â€¢ Return saved recipe with ID                          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â†“                                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          MongoDB (cheffy database)                       â”‚  â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚  Collections:                                            â”‚  â”‚
â”‚  â”‚  â€¢ Conversation (existing)                              â”‚  â”‚
â”‚  â”‚  â€¢ Message (existing)                                   â”‚  â”‚
â”‚  â”‚  â€¢ â­ Recipe (NEW) â† Document inserted here              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†‘
                          â”‚ (HTTP Response)
                          â”‚ { success, recipe: { id, title, ... } }
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CLIENT SIDE (CONTINUED)                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  1. Receive response with recipe.id                            â”‚
â”‚  2. setGeneratedRecipeId(id)                                   â”‚
â”‚  3. window.open(`/recipes/${id}`, '_blank')                   â”‚
â”‚     â†“                                                            â”‚
â”‚  4. Browser opens new tab â†’ /recipes/[id]                     â”‚
â”‚     â†“                                                            â”‚
â”‚  5. â­ NEW PAGE: Recipe Display (/recipes/[id]/page.tsx)       â”‚
â”‚     â€¢ Server-side rendering                                    â”‚
â”‚     â€¢ Fetch recipe from database                              â”‚
â”‚     â€¢ Display beautiful recipe card                           â”‚
â”‚     â€¢ Show ingredients, instructions, metadata                â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. Database Schema Relationship

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXISTING MODELS                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚     Conversation             â”‚                               â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
â”‚  â”‚ id: ObjectId                 â”‚                               â”‚
â”‚  â”‚ userId: String (Clerk)       â”‚  â—„â”€â”€â”€ Owned by User         â”‚
â”‚  â”‚ title: String                â”‚                               â”‚
â”‚  â”‚ messages: Message[]          â”‚  â”€â”                          â”‚
â”‚  â”‚ createdAt: DateTime          â”‚   â”‚ One-to-Many              â”‚
â”‚  â”‚ updatedAt: DateTime          â”‚   â”‚                          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚                          â”‚
â”‚                                      â”‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚                          â”‚
â”‚  â”‚        Message               â”‚ â—„â”€â”˜                          â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
â”‚  â”‚ id: ObjectId                 â”‚                               â”‚
â”‚  â”‚ conversationId: ObjectId     â”‚ â”€â†’ References Conversation   â”‚
â”‚  â”‚ role: String                 â”‚                               â”‚
â”‚  â”‚ content: String              â”‚                               â”‚
â”‚  â”‚ createdAt: DateTime          â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      â­ NEW MODEL                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                               â”‚
â”‚  â”‚       â­ Recipe              â”‚                               â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                               â”‚
â”‚  â”‚ id: ObjectId                 â”‚                               â”‚
â”‚  â”‚ userId: String (Clerk)       â”‚  â—„â”€â”€â”€ Created by User       â”‚
â”‚  â”‚ title: String                â”‚                               â”‚
â”‚  â”‚ description: String          â”‚  âš ï¸  NOT linked to          â”‚
â”‚  â”‚ ingredients: String[]        â”‚     Conversation             â”‚
â”‚  â”‚ instructions: String[]       â”‚     (Independent Collection) â”‚
â”‚  â”‚ prepTime: Int                â”‚                               â”‚
â”‚  â”‚ cookTime: Int                â”‚                               â”‚
â”‚  â”‚ servings: Int                â”‚                               â”‚
â”‚  â”‚ difficulty: String           â”‚                               â”‚
â”‚  â”‚ tags: String[]               â”‚                               â”‚
â”‚  â”‚ imageUrl: String             â”‚                               â”‚
â”‚  â”‚ createdAt: DateTime          â”‚                               â”‚
â”‚  â”‚ updatedAt: DateTime          â”‚                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                               â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â­ KEY DIFFERENCE:
  â€¢ Conversation â†’ tied to specific chat session
  â€¢ Recipe â†’ independent, stand-alone, reusable
  â€¢ User can save conversation AND generate recipe from it
  â€¢ Both are associated with user, but recipe is not tied to conversation
```

## 4. API Endpoint Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                POST /api/recipes/generate                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  INPUT:                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ {                                                        â”‚  â”‚
â”‚  â”‚   "messages": [                                          â”‚  â”‚
â”‚  â”‚     { "role": "user", "content": "..." },              â”‚  â”‚
â”‚  â”‚     { "role": "assistant", "content": "..." }          â”‚  â”‚
â”‚  â”‚   ],                                                     â”‚  â”‚
â”‚  â”‚   "conversationTitle": "..."                            â”‚  â”‚
â”‚  â”‚ }                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â†“                                                        â”‚
â”‚  PROCESSING:                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. auth() â†’ verify userId                               â”‚  â”‚
â”‚  â”‚    if (!userId) â†’ return 401 Unauthorized               â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ 2. Validate messages format                              â”‚  â”‚
â”‚  â”‚    if (!messages || !isArray || length === 0)           â”‚  â”‚
â”‚  â”‚    â†’ return 400 Bad Request                              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ 3. Format conversation text                              â”‚  â”‚
â”‚  â”‚    "User: ...\nAssistant: ...\nUser: ..."              â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ 4. Create LLM prompts                                    â”‚  â”‚
â”‚  â”‚    â€¢ System: Chef recipe creator                        â”‚  â”‚
â”‚  â”‚    â€¢ User: Based on conversation...                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ 5. Call OpenAI API                                       â”‚  â”‚
â”‚  â”‚    fetch('api.openai.com/v1/chat/completions')         â”‚  â”‚
â”‚  â”‚    â€¢ model: gpt-4o-mini                                â”‚  â”‚
â”‚  â”‚    â€¢ temperature: 0.7                                   â”‚  â”‚
â”‚  â”‚    â€¢ max_tokens: 2000                                   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ 6. Parse response                                        â”‚  â”‚
â”‚  â”‚    JSON.parse(llm_response.choices[0].message.content)  â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ 7. Validate recipe structure                             â”‚  â”‚
â”‚  â”‚    Check: title, ingredients[], instructions[]          â”‚  â”‚
â”‚  â”‚    if (!valid) â†’ return 400 Bad Request                â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ 8. Save to database                                      â”‚  â”‚
â”‚  â”‚    saveRecipe(userId, recipeData)                        â”‚  â”‚
â”‚  â”‚    â†’ Prisma creates Recipe document in MongoDB          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ 9. Return success response                               â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                                        â”‚
â”‚         â†“                                                        â”‚
â”‚  OUTPUT:                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ HTTP 201 Created                                         â”‚  â”‚
â”‚  â”‚ {                                                        â”‚  â”‚
â”‚  â”‚   "success": true,                                       â”‚  â”‚
â”‚  â”‚   "recipe": {                                            â”‚  â”‚
â”‚  â”‚     "id": "507f1f77bcf86cd799439011",                  â”‚  â”‚
â”‚  â”‚     "userId": "user_2dL8...",                          â”‚  â”‚
â”‚  â”‚     "title": "Chocolate Cake",                          â”‚  â”‚
â”‚  â”‚     "description": "Delicious homemade...",             â”‚  â”‚
â”‚  â”‚     "ingredients": ["2 cups flour", ...],              â”‚  â”‚
â”‚  â”‚     "instructions": ["Mix dry...", ...],               â”‚  â”‚
â”‚  â”‚     "prepTime": 15,                                     â”‚  â”‚
â”‚  â”‚     "cookTime": 30,                                     â”‚  â”‚
â”‚  â”‚     "servings": 4,                                      â”‚  â”‚
â”‚  â”‚     "difficulty": "easy",                               â”‚  â”‚
â”‚  â”‚     "tags": ["dessert", "vegetarian"],                 â”‚  â”‚
â”‚  â”‚     "createdAt": "2025-12-11T20:30:00Z",              â”‚  â”‚
â”‚  â”‚     "updatedAt": "2025-12-11T20:30:00Z"               â”‚  â”‚
â”‚  â”‚   }                                                      â”‚  â”‚
â”‚  â”‚ }                                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  ERROR RESPONSES:                                                â”‚
â”‚  â€¢ 401: { "error": "Unauthorized" }                             â”‚
â”‚  â€¢ 400: { "error": "No messages provided" }                    â”‚
â”‚  â€¢ 400: { "error": "Invalid recipe structure" }                â”‚
â”‚  â€¢ 500: { "error": "Failed to generate recipe" }              â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. Recipe Display Page Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              GET /recipes/[id] (Server Component)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  1. Extract params from URL                                     â”‚
â”‚     params.id = "507f1f77bcf86cd799439011"                     â”‚
â”‚     â†“                                                            â”‚
â”‚  2. Authenticate user (optional for viewing)                   â”‚
â”‚     const { userId } = await auth()                            â”‚
â”‚     â†“                                                            â”‚
â”‚  3. Fetch recipe from database                                 â”‚
â”‚     const recipe = await getRecipe(id)                         â”‚
â”‚     â†“                                                            â”‚
â”‚  4. Check if recipe exists                                     â”‚
â”‚     if (!recipe) return notFound() â†’ 404 page                 â”‚
â”‚     â†“                                                            â”‚
â”‚  5. Render recipe page                                          â”‚
â”‚     â”œâ”€ Hero image section                                      â”‚
â”‚     â”œâ”€ Title & description                                     â”‚
â”‚     â”œâ”€ Metadata grid (times, servings, difficulty)            â”‚
â”‚     â”œâ”€ Tag badges                                              â”‚
â”‚     â”œâ”€ Two-column layout:                                      â”‚
â”‚     â”‚  â”œâ”€ Ingredients list (left)                             â”‚
â”‚     â”‚  â””â”€ Instructions steps (right)                          â”‚
â”‚     â””â”€ Footer with creation date                              â”‚
â”‚                                                                   â”‚
â”‚  RENDERED COMPONENTS:                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚            [Recipe Image]                          â”‚   â”‚  â”‚
â”‚  â”‚ â”‚ (optional, if imageUrl provided)                  â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ Title: Chocolate Cake                                    â”‚  â”‚
â”‚  â”‚ Description: Delicious homemade chocolate cake...       â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚ â”‚ ğŸ• Prep Time â”‚ ğŸ”¥ Cook Time â”‚ ğŸ½ï¸  Servings        â”‚  â”‚  â”‚
â”‚  â”‚ â”‚     15m      â”‚      30m     â”‚        4            â”‚  â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚  â”‚
â”‚  â”‚ â”‚ Difficulty   â”‚              â”‚                      â”‚   â”‚  â”‚
â”‚  â”‚ â”‚   Easy       â”‚              â”‚                      â”‚   â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ Tags: [dessert] [chocolate] [vegetarian]                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚ â”‚   INGREDIENTS        â”‚  â”‚   INSTRUCTIONS       â”‚        â”‚  â”‚
â”‚  â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚  â”‚
â”‚  â”‚ â”‚ âœ“ 2 cups flour       â”‚  â”‚ â‘  Mix dry ingredientsâ”‚        â”‚  â”‚
â”‚  â”‚ â”‚ âœ“ 1 cup sugar        â”‚  â”‚ â‘¡ Add wet ingredientsâ”‚        â”‚  â”‚
â”‚  â”‚ â”‚ âœ“ 3 eggs             â”‚  â”‚ â‘¢ Bake at 350Â°F     â”‚        â”‚  â”‚
â”‚  â”‚ â”‚ âœ“ 1/2 cup cocoa      â”‚  â”‚ â‘£ Cool for 10 min   â”‚        â”‚  â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚ Created on 12/11/2025                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 6. User Journey Timeline

```
TIME    ACTION                              STATE                  DISPLAY
â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  0s    Page loads                         Not started             "Start Conversation"
        â†“
  5s    Click "Start Conversation"         Connected              "Stop Conversation"
        â†“
 10s    User speaks: "Make a chocolate     Connected              Messages appear
        cake recipe"                                               in chat bubble
        â†“
 15s    AI responds: "I'll help you make   Connected              Response in chat
        a delicious chocolate cake..."                            bubble
        â†“
 25s    User stops conversation            Idle                   "Start Conversation"
        â†“
 30s    Click "Generate Recipe"            Generating             "Generating Recipe..."
        â†“  (API call to /api/recipes/generate)
        â”œâ†’ Authenticate user
        â”œâ†’ Format conversation
        â”œâ†’ Call OpenAI API (~5-15s)
        â”œâ†’ Parse JSON response
        â”œâ†’ Save to MongoDB (~500ms)
        â””â†’ Return recipe ID
        â†“
 45s    Success! New tab opens             Recipe displayed       Recipe card page
        â†“                                                          in new browser tab
        â””â†’ Beautiful recipe page with:
           â€¢ Chocolate Cake title
           â€¢ Ingredients list
           â€¢ Step-by-step instructions
           â€¢ Prep/cook times
           â€¢ Tags and metadata
```

## 7. Component Hierarchy Tree

```
App Root
â”‚
â”œâ”€â”€ Layout (RootLayout)
â”‚   â”œâ”€â”€ ClerkProvider
â”‚   â”œâ”€â”€ Header
â”‚   â”‚   â”œâ”€â”€ SignInButton (if not signed in)
â”‚   â”‚   â”œâ”€â”€ SignUpButton (if not signed in)
â”‚   â”‚   â””â”€â”€ UserButton (if signed in)
â”‚   â”‚
â”‚   â””â”€â”€ Page (/)
â”‚       â”‚
â”‚       â””â”€â”€ ClientWrapper (ğŸ¯ Client Component)
â”‚           â”‚
â”‚           â”œâ”€â”€ ConversationSidebar (Client)
â”‚           â”‚   â”œâ”€â”€ useUser() â†’ Load conversations
â”‚           â”‚   â”œâ”€â”€ fetch /api/conversations
â”‚           â”‚   â””â”€â”€ List of past conversations
â”‚           â”‚
â”‚           â””â”€â”€ Conversation (Client) â­ WITH RECIPE GENERATION
â”‚               â”œâ”€â”€ ElevenLabs Voice Agent
â”‚               â”œâ”€â”€ Message Display
â”‚               â””â”€â”€ Control Buttons:
â”‚                   â”œâ”€â”€ Start Conversation
â”‚                   â”œâ”€â”€ Stop Conversation
â”‚                   â”œâ”€â”€ Save Conversation
â”‚                   â””â”€â”€ â­ Generate Recipe (NEW)
â”‚
â””â”€â”€ Recipe Page (/recipes/[id]) (ğŸ¯ Server Component)
    â”‚
    â”œâ”€â”€ Layout
    â”‚   â”œâ”€â”€ Hero Image
    â”‚   â”œâ”€â”€ Title & Description
    â”‚   â”œâ”€â”€ Metadata Grid
    â”‚   â””â”€â”€ Tags
    â”‚
    â””â”€â”€ Content Grid
        â”œâ”€â”€ Ingredients Column
        â”‚   â”œâ”€â”€ âœ“ Ingredient 1
        â”‚   â”œâ”€â”€ âœ“ Ingredient 2
        â”‚   â””â”€â”€ âœ“ Ingredient N
        â”‚
        â””â”€â”€ Instructions Column
            â”œâ”€â”€ â‘  Instruction 1
            â”œâ”€â”€ â‘¡ Instruction 2
            â””â”€â”€ N Instruction N
```

This comprehensive architecture ensures:
- âœ… Clean separation of concerns
- âœ… Scalable recipe storage
- âœ… Beautiful user experience
- âœ… Proper authentication and authorization
- âœ… Fast LLM-powered recipe generation
